# https://taskfile.dev

version: "3"

vars:
  FIBERV2_URL: https://raw.githubusercontent.com/attapon-th/go-project-template/main/tlp/fiberv2

tasks:
  init:
    cmds:
      - task: tools
      - git init
      - curl -SL "{{.FIBERV2_URL}}/.gitignore" -o .gitignore
      - curl -SL "{{.FIBERV2_URL}}/Taskfile.yaml" -o Taskfile.yaml
      - |
        echo "Example GO Module: github.com/your-name/project-name" \
        && read -p 'Input Go Module: ' gopack \
        && go mod init ${gopack}
      - cobra-cli init --viper
      - task mod

  tools:
    cmds:
      - command -v cobra-cli || go install github.com/spf13/cobra-cli@latest
      - command -v gojq || go install github.com/itchyny/gojq/cmd/gojq@latest
      - command -v swag || go install github.com/swaggo/swag/cmd/swag@latest
      - command -v gosc || go install github.com/attapon-th/go-tools/gosc@latest

  freeze:
    - git ls-files | grep -e "\.go" > fiber-files.txt

  init-fiberv2:
    cmds:
      - |
        cat fiber-files.txt | while read line 
        do
          mkdir -p $(dirname "$line")
          curl -SL "{{.FIBERV2_URL}}/$line" > $line
        done
      - task mod
